:host {
	display: flex;
	position: relative;
}

.color-slider,
.slider-tooltip {
	--transparency: repeating-conic-gradient(transparent 0 25%, rgb(0 0 0 / .05) 0 50%) 0 0 / 1.5em 1.5em content-box border-box;

	--_slider-color-stops: var(--slider-color-stops, transparent 0% 100%);
	--_slider-gradient: var(--slider-gradient, linear-gradient(to right var(--in-space, ), var(--_slider-color-stops)));
	--_slider-height: var(--slider-height, 2.2em);
	--_slider-thumb-width: var(--slider-thumb-width, 1.1em);
	--_slider-thumb-radius: var(--slider-thumb-radius, .16em);
	--_slider-thumb-height-offset: var(--slider-thumb-height-offset, 4px);

	--_tooltip-background: var(--tooltip-background, hsl(0 0 0 / 80%));
	--_tooltip-border-radius: var(--tooltip-border-radius, .3em);
	--_tooltip-pointer-height: var(--tooltip-pointer-height, .3em);
	--_tooltip-pointer-angle: var(--tooltip-pointer-angle, 90deg);
}

.color-slider {
	@supports (background: linear-gradient(in oklch, red, tan)) {
		--in-space: in var(--color-space, oklab) var(--hue-interpolation, );
	}

	display: block;
	margin: 0;
	width: 100%;
	-moz-appearance: none;
	-webkit-appearance: none;
	background: var(--_slider-gradient), var(--transparency);
	height: var(--_slider-height);
	border-radius: .3em;
	box-shadow: 0 0 1px rgba(0, 0, 0, 0.5);

	&::-webkit-slider-thumb {
		-webkit-appearance: none;
		width: var(--_slider-thumb-width);
		height: calc(var(--_slider-height) + var(--_slider-thumb-height-offset));
		border-radius: var(--_slider-thumb-radius);
		border: 1px solid oklab(.2 0 0);
		box-shadow: 0 0 0 1px white;
		background: var(--color, transparent);
	}

	&::-moz-range-thumb {
		width: var(--_slider-thumb-width);
		height: calc(var(--_slider-height) + var(--_slider-thumb-height-offset));
		border-radius: var(--_slider-thumb-radius);
		border: 1px solid oklab(.2 0 0);
		box-shadow: 0 0 0 1px white;
		background: var(--color, transparent);
	}

	&::-moz-range-track {
		background: none;
	}
}

.slider-tooltip {
	position: absolute;
	left: clamp(-20%,
			100% * var(--progress)
			- (var(--progress) - 0.5) * var(--_slider-thumb-width) / 2 /* center on slider thumb */
		, 100%);
	bottom: calc(100% + 3px);
	translate: -50%;
	transform-origin: bottom;
	display: flex;
	padding-block: .3em;
	padding-inline: .4em;
	border: var(--_tooltip-pointer-height) solid transparent;
	border-radius: calc(var(--_tooltip-border-radius) + var(--_tooltip-pointer-height));
	text-align: center;
	color: white;
	background:
		conic-gradient(from calc(-1 * var(--_tooltip-pointer-angle) / 2) at bottom, var(--_tooltip-background) var(--_tooltip-pointer-angle), transparent 0) border-box bottom / 100% var(--_tooltip-pointer-height) no-repeat,
		var(--_tooltip-background) padding-box;
	color-scheme: dark;
	transition:
		visibility 0s step-start,
		opacity 200ms,
		scale 200ms,
		width 100ms,
		left 200ms cubic-bezier(.17,.67,.49,1.48);

	&::after {
		content: var(--tooltip-suffix);
	}

	input {
		all: unset;

		&:where([type=number]) {
			--content-width: calc(var(--value-length) * 1ch);
			width: calc(var(--content-width, 2ch) + 1.2em);
			min-width: calc(2ch + 1.2em);
			box-sizing: content-box;

			&::-webkit-textfield-decoration-container {
				gap: .2em;
			}

			/* Donâ€™t auto hide the spin buttons */
			&::-webkit-inner-spin-button {
				opacity: 1;
			}
		}

		@supports (field-sizing: content) {
			field-sizing: content;
			width: auto;
		}

		/* Prevent input from moving all over the place as we type */
		&:focus {
			transition-delay: .5s;
		}
	}

	&:not(:is(:focus-within, :hover) > *, .color-slider:is(:focus, :hover) + *, :focus, :hover) {
		visibility: hidden;
		opacity: 0;
		scale: .5;
	}
}

:host(:not([tooltip])) .slider-tooltip {
	display: none;
}

:host([tooltip="progress"]) .slider-tooltip {
	--tooltip-suffix: "%";
}